!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var s=new class{constructor(){this.loadSkill=this.loadSkill.bind(this),this.data={}}load(t){return Promise.all(Object.keys(t).map(this.loadSkill))}async loadSkill(t){try{const e=await fetch(`api-cache/${t}.json`),n=await e.json();this.data[t]=n}catch(e){console.log("could not fetch",t),await this.loadSkillFromAPI(t)}}async loadSkillFromAPI(t){try{const e=await fetch("https://api.guildwars2.com/v2/skills/"+t),n=await e.json();this.data[t]=n}catch(e){console.log("really could not fetch",t)}}get(t){return this.data[t]}},i=43470,o=42264,r=44857,a="-12",l="-11",d="-8",c="-6",u="-16",h="-14",p="-10",f="-7",m="-5";function g(t,e){if(t.skillMap)for(const n in t.skillMap){const s=t.skillMap[n];s.id||(s.id=n.substr(1)),e.push(s)}if(t.buffMap)for(const n in t.buffMap){const s=t.buffMap[n];s.id||(s.id=n.substr(1)),e.push(s)}let n={},s={},i={},o=t.players.map((t,e)=>Object.assign({id:e},t)),r=!1;for(let e=0;e<t.players.length;e++){if(t.players[e].hasOwnProperty("details")){let{buffs:i,casts:o}=w(t.players[e].details);n[e]=i,s[e]=o}else{let{buffs:i,casts:o}=y(t.players[e]);r=!0,n[e]=i,s[e]=o}const o=t.players[e].targetDamage1S;o&&o[0]&&(i[e]=o[0][0])}let a={};for(let t of e)a[t.id]=t.name;let l=r?1:1e3;return{boss:t.fightName,players:o,start:t.phases[0].start*l,end:t.phases[0].end*l,skills:a,casts:s,buffs:n,targetDamage1S:i}}function w(t){let e={};for(let n of t.boonGraph[0]){e[n.id]=[];for(let t of n.states){let s=1e3*t[0];0===t[1]?e[n.id].push({Remove:s}):e[n.id].push({Apply:s})}}let n=[];for(let e of t.rotation)if(e[0])for(let e of t.rotation[0]){let t=1e3*e[0],s=e[1],i=e[2],o=e[3];e[4];n.push({id:s,start:t,end:t+i,fired:2!==o})}return{buffs:e,casts:n}}function y(t){let e={},n=[];for(let n of t.buffUptimes){e[n.id]=[];for(let t of n.states){let[s,i]=t;0===i?e[n.id].push({Remove:s}):e[n.id].push({Apply:s})}}t.rotation||(t.rotation=[]);for(let e of t.rotation){let t=e.id;for(let s of e.skills){let e=s.castTime,i=e+s.duration,o=s.duration+s.timeGained>0;n.push({id:t,start:e,end:i,fired:o})}}return{buffs:e,casts:n}}var b={parseJson:function(t){return g(t,[])},getJson:async function(t){const e=await fetch("https://dps.report/getJson?permalink="+t),n=await e.json();if(!n.hasOwnProperty("error"))return g(n,[]);alert(`failed to fetch that log, message from dps.report: "${n.error}"`)}};const v={[40183]:!0},L={5663:"4",43995:"F2"};function S(t){let e=s.get(t.id);if(e&&e.icon)return e.icon}function x(t,e){let n=s.get(t.id);if(n&&n.slot){let t="",e=n.slot.match(/(Weapon|Downed)_(\d)/);if(e&&e.length>0)t=e[2],n.prev_chain&&!n.next_chain&&(t+="f");else if("Elite"===n.slot)t="E";else if("Utility"===n.slot)t="U";else if("Heal"===n.slot)t="H";else if("Toolbelt"===n.slot)t="T";else{let e=n.slot.match(/Profession_(\d)/);e&&e.length>0&&(t="F"+e[1])}return t}if(e[t.id]){let n=e[t.id];if("Dodge"===n)return"D";if(n.startsWith("Chapter")){let t=n.match(/Chapter (\d)/);if(t&&t.length>0)return"C"+t[1]}else if(n.startsWith("Epilogue"))return"C5"}if(L.hasOwnProperty(t.id))return L[t.id]}var E=function(t,e,n,s,i,o,r="icon"){const{railHeight:a,railPad:l,timeToX:d}=i;for(const i of n){if(v[i.id])continue;const n=document.createElementNS("http://www.w3.org/2000/svg","g"),c=document.createElementNS("http://www.w3.org/2000/svg","title");let u=e.skills[i.id]||i.id;u+=` (${((i.start-e.start)/1e3).toFixed(2)+"s"}, ${((i.end-i.start)/1e3).toFixed(2)+"s"})`,c.textContent=u;const h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.classList.add("cast"),i.fired||n.classList.add("cancel"),o&&h.classList.add(o);let p=S(i),f=null;"icon"===r&&(p?(f=document.createElementNS("http://www.w3.org/2000/svg","image"),f.setAttribute("x",d(i.start)),f.setAttribute("y",(a+l)*s+1),f.setAttribute("width",a-2),f.setAttribute("height",a-2),f.classList.add("icon"),f.setAttribute("href",p)):console.warn("No label for skill",i.id,e.skills[i.id]));let m=x(i,e.skills),g=null;"name"!==r&&f||(m?(g=document.createElementNS("http://www.w3.org/2000/svg","text"),g.setAttribute("x",d(i.start)),g.setAttribute("y",(a+l)*s+a/2),g.classList.add("name"),g.textContent=m):console.warn("No label for skill",i.id,e.skills[i.id])),h.setAttribute("x",d(i.start)),h.setAttribute("y",(a+l)*s);const w=d(i.end)-d(i.start);w>6?h.setAttribute("width",w):(h.setAttribute("width",2),h.classList.add("cast-instant")),h.setAttribute("height",a),n.appendChild(c),n.appendChild(h),f&&n.appendChild(f),g&&n.appendChild(g),t.appendChild(n)}};function A(t){const e=new Array(t.length);let n=0;for(let s=0;s<t.length;s++){let i=0;s>=10&&(i=t[s-10]);let o=(t[s]-i)/10;e[s]=o,n=Math.max(o,n)}return{dps10s:e,max:n}}function C(t,e,n){const{railHeight:s,railPad:i}=e;let o=2*(s+i)+i;if(n)return function(e){return o-e/t*o+i};let r=1.5*t,a=Math.log(r-t),l=Math.log(r);return function(t){const e=Math.log(r-t);return(a-e)/(a-l)*o+i}}function k(t,e,n,s,i){const{timeToX:o}=s;let r="",a=C(n,s,i);for(let n=0;n<e.length;n++){r+=0===n?"M":"L",r+=o(1e3*n+t.start)+" "+a(e[n])+" "}const l=document.createElementNS("http://www.w3.org/2000/svg","path");return l.setAttribute("d",r),l.classList.add("dps-path"),l}class M{constructor(t,e,n,s,i){this.dps10s=e,this.benchDps10s=n,this.timeToX=i.timeToX,this.toY=C(s,i),this.elt=document.createElementNS("http://www.w3.org/2000/svg","g"),this.elt.classList.add("tooltip"),this.elt.classList.add("tooltip-hidden"),this.diffLine=document.createElementNS("http://www.w3.org/2000/svg","path"),this.diffLine.classList.add("tooltip-path"),this.explanation=document.createElementNS("http://www.w3.org/2000/svg","text"),this.explanation.classList.add("tooltip-explanation"),this.elt.appendChild(this.diffLine),this.elt.appendChild(this.explanation),t.appendChild(this.elt)}show(t,e){if(e<0)return;let n=this.timeToX(t);this.elt.setAttribute("transform",`translate(${n} 0)`),this.diffLine.setAttribute("d","");let s="",i=0;if(e<this.dps10s.length){let t=this.dps10s[e],n=this.toY(t);if(i=n,e<this.benchDps10s.length){let o=this.benchDps10s[e],r=this.toY(o);i=Math.min(i,(n+r)/2);let a=`M0 ${n} L0 ${r}`;this.diffLine.setAttribute("d",a);let l=t-o;s=`${l>0?"Ahead":"Behind"} ${Math.abs(Math.round(l))} at ${e}s (${Math.round(t)} vs ${Math.round(o)})`}else s=""+Math.round(t)}this.explanation.textContent=s,this.explanation.setAttribute("x",2),this.explanation.setAttribute("y",i),this.elt.classList.remove("tooltip-hidden")}hide(){this.elt.classList.add("tooltip-hidden")}}var N=function(t,e,n,s,i){const{railHeight:o,railPad:r,xToTime:a}=s,{dps10s:l,max:d}=A(e.targetDamage1S),{dps10s:c,max:u}=A(n.targetDamage1S),h=Math.max(d,u),p=k(e,l,h,s,i),f=k(e,c,h,s,i);f.classList.add("dps-path-benchmark"),t.appendChild(f),t.appendChild(p);const m=new M(t,l,c,h,s),g=t.parentNode;let w;t.addEventListener("mousemove",(function(t){w||(w=g.getBoundingClientRect());let n=t.clientX+g.scrollLeft-w.left,s=a(n),i=Math.round((s-e.start)/1e3);m.show(1e3*i+e.start,i)})),t.addEventListener("mouseleave",(function(){m.hide()}))};const P=document.querySelector(".setup-container");!async function(){const t=document.querySelector(".dpsreport-text"),e=document.querySelector(".dpsreport-submit");function n(){let i=t.value.trim();if(!/^https:\/\/(dps|wvw)\.report\/[^/]+$/.test(i))return void alert("Paste in format https://dps.report/Sosx-20180802-193036_cairn");let o=new URL(i);var r;e.value="Fetching",e.removeEventListener("click",n),e.removeEventListener("keypress",s),r=o.pathname.substr(1),b.getJson(r).then((function(t){t&&(P.classList.add("hidden"),T(t))})).catch(t=>{alert("failed to fetch that log, typo maybe?")})}function s(t){"Enter"===t.key&&n()}e.addEventListener("click",n),t.addEventListener("keypress",s);let i=document.getElementById("log-input");i.addEventListener("change",(function(){document.querySelector("#log-input + label").textContent="Parsing";let t=i.files[0];setTimeout((function(){!function(t){const e=new FileReader;e.onload=function(t){try{const e=t.target.result;let n=b.parseJson(JSON.parse(e));P.classList.add("hidden"),T(n)}catch(t){alert("Failed to parse log file, should be JSON blob")}},e.readAsText(t)}(t)}),100)})),P.classList.remove("hidden");let o=document.querySelector(".gameplay-video-container"),r=document.querySelector(".gameplay-video"),a=document.getElementById("video-input");a.addEventListener("change",(function(){let t=document.querySelector("#video-input + label");t.textContent="Uploading";let e=a.files[0];setTimeout((function(){const n=new FileReader;n.onload=function(t){let n=document.createElement("source");n.src=t.target.result,n.type=e.type,r.appendChild(n),o.classList.remove("no-video")},n.onprogress=function(e){if(e.lengthComputable){let n=Math.floor(100*e.loaded/e.total)+"%";t.textContent="Uploading "+n}},n.readAsDataURL(e)}),100)}))}();async function T(t){for(let e in t.casts)t.casts[e].sort((function(t,e){return t.start-e.start}));const e={};for(let n in t.casts)for(let s of t.casts[n])e[s.id]=!0;for(let n in t.skills)/^[A-Z]/.test(t.skills[n])&&(e[n]=!0);await s.load(e),document.querySelector(".container").classList.remove("hidden");const n=(t.end-t.start)/20,g=document.querySelector(".timeline"),w=document.querySelector(".gameplay-video"),y=document.createElement("div");y.classList.add("board-container");const b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.style.width=n+"px",b.classList.add("board"),y.appendChild(b);const v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.classList.add("legend");const L=document.createElementNS("http://www.w3.org/2000/svg","rect");function S(e){return n*(e-t.start)/(t.end-t.start)}function x(e){return e/n*(t.end-t.start)+t.start}L.setAttribute("x",0),L.setAttribute("y",0),L.setAttribute("width",2),L.classList.add("needle"),b.appendChild(L),g.appendChild(v),g.appendChild(y);const E={[i]:"Fire/Fire",[c]:"Fire/Air",[m]:"Fire/Water",[f]:"Fire/Earth",[o]:"Air/Air",[a]:"Air/Water",[l]:"Air/Fire",[d]:"Water/Fire",[p]:"Water/Earth",[r]:"Earth/Earth",[u]:"Earth/Air",[h]:"Earth/Fire"};for(const e in E)t.skills[e]=E[e];const A={railHeight:20,railPad:4,width:n,timeToX:S,xToTime:x},C={showDps:!1,sortByProfession:!1,showIcons:!0},k=document.getElementById("show-dps");k.checked=C.showDps;const M=document.getElementById("sort-by-profession");M.checked=C.sortByProfession;const N=document.getElementById("show-icons");function P(e){return function(n){C[e]=n.target.checked,j(t,A,C)}}N.checked=C.showIcons,k.addEventListener("change",P("showDps")),M.addEventListener("change",P("sortByProfession")),N.addEventListener("change",P("showIcons")),j(t,A,C);let T=y.getBoundingClientRect();function D(t,e){const n=S(t);L.setAttribute("x",n),(!e||n<y.scrollLeft||n>y.scrollLeft+T.width)&&(y.scrollLeft=n-T.width/2)}b.addEventListener("click",(function(t){D(x(t.clientX+y.scrollLeft-T.left),!0)})),document.body.addEventListener("click",(function(t){if(t.target.classList.contains("time-link")){t.preventDefault();let e=parseFloat(t.target.dataset.start);e&&D(e,!0)}})),w.addEventListener("timeupdate",(function(){D(1e3*(w.currentTime-C.videoOffset)+t.start)}))}function D(t){const e=document.createElementNS("http://www.w3.org/2000/svg","title");e.textContent=t;const n=document.createElementNS("http://www.w3.org/2000/svg","title");n.textContent=t;const s=document.createElementNS("http://www.w3.org/2000/svg","use");return s.setAttribute("xlink:href","#adjust-solid"),s.appendChild(n),[e,s]}function F(t,e){return t.players[e].group}function O(t,e){return t.players[e].profession}function j(t,e,n){const{railHeight:s,railPad:i}=e,o=document.querySelector(".board"),r=document.querySelector(".legend"),a=document.querySelector(".needle");o.innerHTML="",r.innerHTML="";let l=0;if(n.showDps){let n=[];for(let e of t.players){let t=e.damage1S[0];for(let e=0;e<t.length;e++)e>=n.length&&n.push(0),n[e]+=t[e]}t.targetDamage1S=n,N(o,t,{targetDamage1S:[]},e,!0);const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.textContent="Damage per 10s",i.setAttribute("x",0),i.setAttribute("y",s/2),i.classList.add("name"),r.appendChild(i),l+=3}let d=Object.keys(t.casts);n.sortByProfession?d.sort((function(e,n){return O(t,e).localeCompare(O(t,n))})):d.sort((function(e,n){return F(t,e)-F(t,n)}));for(let n of d){const a=document.createElementNS("http://www.w3.org/2000/svg","g"),d=document.createElementNS("http://www.w3.org/2000/svg","text"),c=t.players[n],[u,h]=D(c.account);d.textContent=c.name,d.setAttribute("x",0),d.setAttribute("y",l*(s+i)+s/2),d.classList.add("name"),a.appendChild(u),a.appendChild(h),a.appendChild(d),r.appendChild(a),E(o,t,t.casts[n],l,e),l+=1}const c=0+l;o.style.height=c*(s+i)-i+"px",r.style.height=c*(s+i)-i+"px",a.setAttribute("height",c*(s+i)-i),o.appendChild(a)}}]);